const e="change",t="input",n="load",a="click",o="mouseenter",r="mouseout",l="wheel",d="focus",c="blur",i="ui-mark",u="ui-mark-container",s="ui-number",m="ui-number-container",E="ui-fixed-container",f="convert",y="active",v="skin",h="ui-layer-ind",g="ui-layer-name",L="highlight",A="off",I="material-symbols-rounded",S="beta",N="[data-layer='",p="']",T="div",B="img",_="i",R="style",O="number",b="range",M="block",C="none",q="center",w="left",U="WatchFont",k="#00000000",H="visibility",D="visibility_off",F="delete_forever",P=document.getElementById("SCREEN"),K=document.getElementById("BACKGROUND_COLOR"),W=document.getElementById("BACKGROUND_TRANSPARENT"),x=document.getElementById("MARK"),G=document.getElementById("AMOUNT_MARK"),V=document.getElementById("MARK_SIZE"),X=document.getElementById("ZOOM"),Z=document.getElementById("ZOOM_IN"),Y=document.getElementById("ZOOM_OUT"),z=document.getElementById("MARK_SPACE"),J=document.getElementById("MARK_ROTATE"),j=document.getElementById("MARK_ROTATE_DIAL"),Q=document.getElementById("SCREEN_ROTATE"),$=document.getElementById("NUMBERS"),ee=document.getElementById("NUMBERS_SIZE"),te=document.getElementById("AMOUNT_NUMBERS"),ne=document.getElementById("NUMBERS_SPACE"),ae=document.getElementById("NUMBERS_ROTATE"),oe=document.getElementById("FONT"),re=document.getElementById("ZOOM_VALUE"),le=document.getElementById("FONT_INPUT_BTN"),de=document.getElementById("MARK_INPUT_BTN"),ce=document.getElementById("NEW"),ie=document.getElementById("EXPORT"),ue=document.getElementById("CONVERT"),se=document.getElementById("MARK_VIS"),me=document.getElementById("NUMBERS_VIS"),Ee=document.getElementById("SKIN"),fe=document.getElementById("INFO"),ye=document.getElementById("BETA"),ve=document.getElementById("LAYER_OPTION_DELETE_ALL"),he=document.getElementById("LAYER_OPTION_FROM_VISIBLE"),ge=document.getElementById("MARK_FILE"),Le=document.getElementById("WATCH_CONTAINER"),Ae=document.getElementById("WATCH"),Ie=document.getElementById("WATCH_SCREEN_RESOLUTION"),Se=document.getElementById("HIDDEN"),Ne=document.getElementById("LOADING"),pe=document.getElementById("LOADING_MESSAGE"),Te=document.querySelectorAll("#LAYER_CONTAINER [data-tooltip]"),Be=document.getElementById("TOOLTIP_VALUE"),_e=document.getElementById("GROUP_NUMBERS_CONTENT"),Re=document.getElementById("GROUP_FIXED_CONTENT"),Oe=document.getElementById("GROUP_MARK_CONTENT"),be="Hide",Me="Show",Ce="Loading",qe="Exporting",we="Creating layer",Ue="Delete",ke="Show",He="Hide",De=".png",Fe="WDC_",Pe="num_",Ke="mark_";PREFIX_FIXED="fixed_";const We="zoom";var xe=45,Ge=1,Ve=!1,Xe=450,Ze=0,Ye=0;function ze(){ce.addEventListener(a,function(){confirm("|--------------------------------------------------|\n|                 CREATE NEW PROJECT ?                 |\n|                                                                         |\n|                      ALL WILL BE LOST                      |\n|--------------------------------------------------|\n\n")&&location.reload()}),ie.addEventListener(a,Je),K.addEventListener(t,nt),X.addEventListener(t,rt),Z.addEventListener(a,at),Y.addEventListener(a,ot),Le.addEventListener(l,function(e){Number(e.deltaY)>0?ot():at()}),Ie.addEventListener(d,function(){Ie.value=Xe,Ie.style.textAlign=q,Ie.placeholder=""}),Ie.addEventListener(c,function(){var e=Number(Ie.value);isNaN(e)?e=Xe:0==(e=e.toFixed(0))?e=Xe:Xe=e,Ie.value="",Ie.style.textAlign=w,Ie.placeholder=e+"x"+e}),de.addEventListener(a,function(){x.click()}),x.addEventListener(e,function(e){const t=e.target.files;var n=new FileReader;n.onload=function(){ge.src=n.result,x.dataset.name=t[0].name,dt()},n.readAsDataURL(t[0])}),G.addEventListener(t,dt),V.addEventListener(t,ct),z.addEventListener(t,it),J.addEventListener(t,ut),j.addEventListener(t,st),Q.addEventListener(t,It),$.addEventListener(a,yt),ne.addEventListener(t,vt),ae.addEventListener(t,ht),ee.addEventListener(t,function(){document.querySelectorAll("."+s).forEach(function(e){e.setAttribute(R,_t())})}),ue.addEventListener(a,function(){ue.classList.toggle(y),this.dataset.type===b?(this.dataset.type=O,document.querySelectorAll("."+f).forEach(function(e){e.type=O})):(this.dataset.type=b,document.querySelectorAll("."+f).forEach(function(e){e.type=b}))}),le.addEventListener(a,function(){oe.click()}),oe.addEventListener(e,function(e){const t=e.target.files;var n=new FileReader;n.onload=async function(){var e=new FontFace(U,n.result);await e.load(),document.fonts.add(e),P.style.fontFamily=U,le.innerHTML=t[0].name},n.readAsArrayBuffer(t[0])}),me.addEventListener(a,gt),se.addEventListener(a,mt),Ee.addEventListener(a,lt),fe.addEventListener(a,$e),ye.addEventListener(a,tt),ve.addEventListener(a,Mt),he.addEventListener(a,Ct),Te.forEach(function(e){bt(e)})}function Je(){je(qe),W.checked&&(P.style.backgroundColor=k),Ae.removeAttribute(R);var e=Fe;localStorage.getItem("file_id")?e+=Number(localStorage.getItem("file_id"))+1:(e+=1,localStorage.setItem("file_id",1));var t=document.createElement("a");t.download=e+"_number_layer"+De,t.target="_blank";var n=document.createElement("a");n.download=e+"_mark_layer"+De,n.target="_blank";var a=document.createElement("a");a.download=e+De,a.target="_blank",Se.appendChild(t),Se.appendChild(n),Se.appendChild(a),Et(),At(),html2canvas(P,{backgroundColor:k,width:Xe,height:Xe,windowWidth:Xe}).then(function(e){t.href=e.toDataURL(),ft(),Lt(),html2canvas(P,{backgroundColor:k,width:Xe,height:Xe,windowWidth:Xe}).then(function(e){n.href=e.toDataURL(),At(),html2canvas(P,{backgroundColor:k,width:Xe,height:Xe,windowWidth:Xe}).then(function(e){a.href=e.toDataURL(),t.click(),n.click(),a.click(),t.remove(),n.remove(),a.remove(),nt(),rt(),Qe()})})})}function je(e){e=e||Ce,pe.innerHTML=e,Ne.classList.add(y),Ne.style.display=M}function Qe(){setTimeout(function(){Ne.style.display=C,Ne.classList.remove(y)},1e3)}function $e(){alert("v1.0.0"),4===++Ye&&(alert("Beta features enabled!\n\nThese features are under development and may cause problems."),et())}function et(){document.querySelectorAll("."+S).forEach(function(e){e.classList.remove(S)}),Ye=4,localStorage.setItem(S,"enabled")}function tt(){Ye=0,localStorage.removeItem(S),document.querySelectorAll("[data-beta]").forEach(function(e){e.classList.add(S)}),Re.querySelectorAll("."+h).forEach(function(e){document.querySelectorAll(N+e.dataset.layer+p).forEach(function(e){e.remove()})}),alert("Beta features disabled!")}function nt(){P.style.backgroundColor=K.value}function at(){var e=Number(X.value);e+=.05,X.value=e,rt()}function ot(){var e=Number(X.value);e-=.05,X.value=e,rt()}function rt(){var e=X.value;localStorage.setItem(We,e),Ae.style.transform="scale("+e+")",re.placeholder=Rt(e)}function lt(){Ae.classList.toggle(v),Ee.classList.toggle(y)}function dt(){Oe.querySelectorAll("."+h).forEach(function(e){document.querySelectorAll(N+e.dataset.layer+p).forEach(function(e){e.remove()})});for(var e=Tt(G.value),t=1;t<e.length;t++)P.appendChild(St(e[t])),Oe.appendChild(pt(Ke,t)),Ze++;st(),ft()}function ct(){Ge=V.value;const e=Bt();document.querySelectorAll("."+i).forEach(function(t){t.setAttribute(R,e)})}function it(){var e=z.value+"%";document.querySelectorAll("."+u).forEach(function(t){t.style.height=e})}function ut(){xe=J.value;const e=Bt();document.querySelectorAll("."+i).forEach(function(t){t.setAttribute(R,e)})}function st(){var e=Number(j.value);document.querySelectorAll("."+u).forEach(function(t){var n=t.style.height,a=Ot(Number(t.dataset.rotate)+e,!0);t.setAttribute(R,a),t.style.height=n})}function mt(){se.innerHTML===be?Et():ft()}function Et(){se.innerHTML=Me,document.querySelectorAll("."+u).forEach(function(e){e.style.display=C})}function ft(){se.innerHTML=be,document.querySelectorAll("."+u).forEach(function(e){e.style.display=M})}function yt(){_e.querySelectorAll("."+h).forEach(function(e){document.querySelectorAll(N+e.dataset.layer+p).forEach(function(e){e.remove()})});for(var e=Tt(Number(te.value)),t=1;t<e.length;t++)P.appendChild(Nt(t,e[t])),_e.appendChild(pt(Pe,t)),Ze++;ht(),At()}function vt(){var e=ne.value+"%";document.querySelectorAll("."+m).forEach(function(t){t.style.height=e})}function ht(){var e=Number(ae.value);document.querySelectorAll("."+m).forEach(function(t){var n=t.style.height,a=Ot(Number(t.dataset.rotate)+e,!0);t.setAttribute(R,a),t.style.height=n})}function gt(){me.innerHTML===be?Lt():At()}function Lt(){me.innerHTML=Me,document.querySelectorAll("."+m).forEach(function(e){e.style.display=C})}function At(){me.innerHTML=be,document.querySelectorAll("."+m).forEach(function(e){e.style.display=M})}function It(){P.style=Ot(Q.value,!0)}function St(e){var t=document.createElement(T);t.className=u,t.style.transform=Ot(e-45),t.dataset.rotate=e-45,t.dataset.layer=Ze;var n=document.createElement(B);return n.className=i,n.src=ge.src,n.setAttribute(R,Bt()),t.appendChild(n),t}function Nt(e,t){var n=document.createElement(T);n.className=m,n.style.transform=Ot(t-75),n.dataset.rotate=t-75,n.dataset.layer=Ze;var a=document.createElement(T);return a.className=s,a.innerHTML=e,a.setAttribute(R,_t()),n.appendChild(a),n}function pt(e,t){var n=document.createElement(T);n.className=h,n.dataset.layer=Ze,n.addEventListener(o,function(){document.querySelectorAll(N+this.dataset.layer+p)[1].classList.add(L)}),n.addEventListener(r,function(){document.querySelectorAll(N+this.dataset.layer+p)[1].classList.remove(L)});var l=document.createElement(_);l.className=I,l.innerHTML=H,l.dataset.tooltip=He,l.addEventListener(a,function(){this.classList.contains(A)?(this.classList.remove(A),this.innerHTML=H,this.dataset.tooltip=He,document.querySelectorAll(N+this.parentElement.dataset.layer+p)[1].style.display=M):(this.classList.add(A),this.innerHTML=D,this.dataset.tooltip=ke,document.querySelectorAll(N+this.parentElement.dataset.layer+p)[1].style.display=C),Be.innerHTML=this.dataset.tooltip}),bt(l);var d=document.createElement(T);d.className=g,d.innerHTML=e+t;var c=document.createElement(_);return c.className=I,c.innerHTML=F,c.dataset.tooltip=Ue,c.addEventListener(a,function(){document.querySelectorAll(N+this.parentElement.dataset.layer+p).forEach(function(e){e.remove()})}),bt(c),n.appendChild(l),n.appendChild(d),n.appendChild(c),n}function Tt(e){var t=[],n=360/e,a=n,o=0;for(e++;o<e;)t.push(a),a+=n,o++;return t}function Bt(){return"transform: translate(50%, -50%) rotate("+xe+"deg) scale("+Ge+");"}function _t(){return"transform: translate(50%, -50%) rotate(45deg); font-size: "+ee.value+"px; width: "+ee.value+"px;"}function Rt(e){return(e=(100*e).toFixed(0))+"%"}function Ot(e,t){return((t=t||!1)?"transform: ":"")+"rotate("+e+"deg);"}function bt(e){e.addEventListener(o,function(){Be.innerHTML=e.dataset.tooltip}),e.addEventListener(r,function(){Be.innerHTML=""})}function Mt(){Re.querySelectorAll("."+h).forEach(function(e){document.querySelectorAll(N+e.dataset.layer+p).forEach(function(e){e.remove()})}),_e.querySelectorAll("."+h).forEach(function(e){document.querySelectorAll(N+e.dataset.layer+p).forEach(function(e){e.remove()})}),Oe.querySelectorAll("."+h).forEach(function(e){document.querySelectorAll(N+e.dataset.layer+p).forEach(function(e){e.remove()})})}function Ct(){je(we),setTimeout(function(){P.style.backgroundColor=k,Ae.removeAttribute(R),html2canvas(P,{backgroundColor:k,width:Xe,height:Xe,windowWidth:Xe}).then(function(e){var t=document.createElement(B);t.className=E,t.dataset.layer=Ze,t.src=e.toDataURL(),P.prepend(t),Re.appendChild(pt(PREFIX_FIXED,Ze)),Ze++,nt(),rt(),Qe()})},500)}window.onload=function(){ze(),localStorage.getItem(S)&&et(),localStorage.getItem(We)&&(X.value=localStorage.getItem(We)),rt()};